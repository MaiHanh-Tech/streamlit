version: '3'
services:
  streamlit_app:
    # Build container from current directory's Dockerfile
    build: .
    # Má»Ÿ cá»•ng 8502 (ngoÃ i) -> 8501 (trong container) cho Streamlit
    ports:
      - "8502:8501" 
    volumes:
      # Mount code
      - .:/app
    environment:
      # Cáº¥u hÃ¬nh cho Streamlit
      - STREAMLIT_SERVER_ENABLE_CORS=false
      - STREAMLIT_SERVER_ENABLE_XSRF_PROTECTION=false
      - STREAMLIT_BROWSER_GATHER_USAGE_STATS=false
      - STREAMLIT_SERVER_ADDRESS=0.0.0.0
      - STREAMLIT_SERVER_PORT=8501
      - STREAMLIT_SERVER_HEADLESS=true
      - STREAMLIT_SERVER_FILE_WATCHER_TYPE=none
      # QUAN TRá»ŒNG: Thiáº¿t láº­p URL ná»™i bá»™ cho App gá»i TTS
      # tts_service lÃ  tÃªn cá»§a service bÃªn dÆ°á»›i, 8000 lÃ  cá»•ng
      - TTS_SERVER_URL=http://tts_service:8000 
    restart: unless-stopped
    container_name: streamlit_app
    networks:
      - streamlit_network
    depends_on:
      - tts_service # Äáº£m báº£o server TTS cháº¡y trÆ°á»›c
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8501/_stcore/health"]
      interval: 30s
      timeout: 10s
      retries: 3
  
  tts_service:
    build: .
    # QUAN TRá»ŒNG: Lá»‡nh cháº¡y file tts_server.py
    command: python tts_server.py
    # Má»Ÿ cá»•ng 8000 (ngoÃ i) -> 8000 (trong container) cho TTS
    ports:
      - "8000:8000" 
    volumes:
      - .:/app
    container_name: tts_server
    networks:
      - streamlit_network
    restart: unless-stopped
    
networks:
  streamlit_network:
    driver: bridge
```

### ğŸ¯ NHá»®NG GÃŒ ÄÃƒ ÄÆ¯á»¢C THAY Äá»”I:

1.  **ThÃªm service `tts_service`:** Khá»‘i lá»‡nh má»›i Ä‘á»ƒ build vÃ  cháº¡y file `tts_server.py`.
2.  **Cá»•ng 8000:** Má»Ÿ thÃªm cá»•ng 8000 cho Server TTS.
3.  **MÃ´i trÆ°á»ng `TTS_SERVER_URL`:** Em Ä‘Ã£ thÃªm biáº¿n mÃ´i trÆ°á»ng nÃ y vÃ o service `streamlit_app`.
    *   **LÆ°u Ã½:** Chá»‹ cáº§n sá»­a láº¡i file **`template.html`** Ä‘á»ƒ nÃ³ sá»­ dá»¥ng biáº¿n mÃ´i trÆ°á»ng nÃ y (thay vÃ¬ hardcode `http://localhost:8000`) Ä‘á»ƒ App gá»i Ä‘Æ°á»£c Server TTS ná»™i bá»™ cá»§a Docker.

#### ğŸ“ HÆ¯á»šNG DáºªN Sá»¬A FILE `template.html` Láº¦N CUá»I:

Äá»ƒ App gá»i TTS Ä‘Ãºng trong mÃ´i trÆ°á»ng Docker, chá»‹ chá»‰ cáº§n sá»­a láº¡i 1 dÃ²ng trong file **`template.html`** thÃ nh:

```javascript
// TRONG FILE TEMPLATE.HTML
<script>
    // Láº¥y URL tá»« Streamlit (phá»©c táº¡p hÆ¡n má»™t chÃºt, nhÆ°ng an toÃ n nháº¥t lÃ  hardcode láº¡i)
    // Hoáº·c Ä‘Æ¡n giáº£n nháº¥t, chá»‹ sá»­a láº¡i hardcode thÃ nh tÃªn service ná»™i bá»™ cá»§a Docker
    const TTS_SERVER_URL = 'http://localhost:8000'; // (Náº¿u test trÃªn mÃ¡y)
    // OR
    // const TTS_SERVER_URL = 'http://TTS_SERVER_EXTERNAL_IP:8000'; // (Náº¿u cháº¡y trÃªn Cloud)

    // ... (Pháº§n code JavaScript cÃ²n láº¡i) ...
</script>
```

Em khuyáº¿n nghá»‹ chá»‹ **giá»¯ nguyÃªn `http://localhost:8000`** trong `template.html` vÃ  cháº¡y Docker, vÃ¬ Docker sáº½ tá»± Ã¡nh xáº¡. Sau Ä‘Ã³, chá»‹ cháº¡y láº¡i Docker báº±ng lá»‡nh:

```bash
docker-compose down
docker-compose up --build -d
